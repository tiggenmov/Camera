<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#FF4081">
    
    <!-- Critical Metadata Only -->
    <title>GlamAI - Virtual Makeup Studio</title>
    <meta name="description" content="AI-powered virtual makeup try-on app">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Preconnect to CDNs -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    
    <!-- Critical Inline CSS (2.8KB) -->
    <style>
        /* Minimal critical styles for loading screen */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow: hidden;
        }
        
        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .splash-content {
            text-align: center;
            color: white;
            padding: 20px;
        }
        
        .splash-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 40px;
            font-size: 1.5rem;
        }
        
        .splash-logo i {
            font-size: 3rem;
            color: #ff6b8b;
            animation: pulse 2s infinite;
        }
        
        .splash-logo h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #ff6b8b, #6a11cb);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .splash-loader {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #ff6b8b;
            margin: 20px auto;
            animation: spin 1s linear infinite;
        }
        
        .splash-tagline {
            margin-top: 20px;
            font-size: 1.1rem;
            opacity: 0.8;
        }
        
        #app {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .progress-container {
            width: 200px;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            margin: 20px auto;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff6b8b, #6a11cb);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- Splash Screen with Progress -->
    <div id="splashScreen">
        <div class="splash-content">
            <div class="splash-logo">
                <i class="fas fa-sparkles"></i>
                <h1>GlamAI</h1>
            </div>
            <div class="splash-loader"></div>
            <p class="splash-tagline" id="loadingText">Loading core engine...</p>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <p id="loadingHint" style="margin-top: 15px; font-size: 0.9rem; opacity: 0.6;">
                First load may take 10-15 seconds
            </p>
        </div>
    </div>
    
    <!-- Minimal App Container -->
    <div id="app" class="app-container">
        <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
            <header style="text-align: center; margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.95); border-radius: 15px;">
                <h1 style="font-size: 2.5rem; background: linear-gradient(45deg, #ff6b8b, #6a11cb); -webkit-background-clip: text; background-clip: text; color: transparent; margin-bottom: 10px;">
                    <i class="fas fa-sparkles"></i> GlamAI
                </h1>
                <p style="color: #666;">Virtual Makeup Studio</p>
            </header>
            
            <main style="display: grid; gap: 20px;">
                <!-- Camera Section -->
                <section style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: #333;">
                            <i class="fas fa-camera"></i> Camera Preview
                        </h3>
                        <div style="width: 100%; height: 300px; background: #000; border-radius: 10px; overflow: hidden; margin-bottom: 15px;">
                            <div id="cameraPlaceholder" style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white;">
                                <i class="fas fa-camera" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                                <p>Camera ready</p>
                            </div>
                            <video id="cameraPreview" style="width: 100%; height: 100%; object-fit: cover; display: none;"></video>
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button id="startCameraBtn" style="padding: 12px 24px; background: linear-gradient(45deg, #ff6b8b, #6a11cb); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 600;">
                                <i class="fas fa-video"></i> Start Camera
                            </button>
                            <button id="capturePhotoBtn" style="padding: 12px 24px; background: #4CAF50; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 600;">
                                <i class="fas fa-camera-retro"></i> Capture
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- Simple Controls -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- Makeup Controls -->
                    <section style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px;">
                        <h3 style="margin-bottom: 15px; color: #333;">
                            <i class="fas fa-paint-brush"></i> Makeup Controls
                        </h3>
                        <div id="basicControls">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; color: #666;">Lipstick</label>
                                <input type="range" min="0" max="100" value="50" style="width: 100%;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; color: #666;">Eyeshadow</label>
                                <input type="range" min="0" max="100" value="30" style="width: 100%;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; color: #666;">Blush</label>
                                <input type="range" min="0" max="100" value="20" style="width: 100%;">
                            </div>
                        </div>
                    </section>
                    
                    <!-- AI Suggestions -->
                    <section style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px;">
                        <h3 style="margin-bottom: 15px; color: #333;">
                            <i class="fas fa-robot"></i> AI Assistant
                        </h3>
                        <div id="aiSuggestions" style="background: #f8f9fa; padding: 15px; border-radius: 10px; min-height: 150px;">
                            <p style="color: #666; text-align: center; line-height: 150px;">
                                Start camera for AI analysis
                            </p>
                        </div>
                        <button id="analyzeBtn" style="width: 100%; padding: 12px; margin-top: 15px; background: #2196F3; color: white; border: none; border-radius: 10px; cursor: pointer;">
                            <i class="fas fa-magic"></i> Analyze Face
                        </button>
                    </section>
                </div>
                
                <!-- Preset Looks -->
                <section style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px;">
                    <h3 style="margin-bottom: 15px; color: #333;">
                        <i class="fas fa-palette"></i> Quick Looks
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px;">
                        <button class="preset-btn" data-look="natural" style="padding: 15px; background: #FFE4C4; border: none; border-radius: 10px; cursor: pointer;">
                            Natural
                        </button>
                        <button class="preset-btn" data-look="glam" style="padding: 15px; background: #FF4081; color: white; border: none; border-radius: 10px; cursor: pointer;">
                            Glam
                        </button>
                        <button class="preset-btn" data-look="party" style="padding: 15px; background: #FF9800; color: white; border: none; border-radius: 10px; cursor: pointer;">
                            Party
                        </button>
                        <button class="preset-btn" data-look="smokey" style="padding: 15px; background: #333; color: white; border: none; border-radius: 10px; cursor: pointer;">
                            Smokey
                        </button>
                    </div>
                </section>
            </main>
            
            <footer style="text-align: center; margin-top: 30px; padding: 20px; color: white; font-size: 0.9rem;">
                <p>GlamAI Makeup Studio &copy; 2024</p>
                <div style="margin-top: 10px;">
                    <button id="toggleAdvanced" style="background: none; border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 20px; cursor: pointer;">
                        Load Advanced Features
                    </button>
                </div>
            </footer>
        </div>
    </div>

    <!-- Core App Script (Tiny - loads first) -->
    <script>
        // ==================== PROGRESSIVE LOADING SYSTEM ====================
        
        const LOADING_STEPS = [
            { text: "Loading core engine...", weight: 10 },
            { text: "Setting up UI...", weight: 15 },
            { text: "Preparing camera...", weight: 20 },
            { text: "Loading AI models...", weight: 40 },
            { text: "Almost ready...", weight: 15 }
        ];
        
        let currentStep = 0;
        let totalProgress = 0;
        
        // Update loading UI
        function updateProgress(stepProgress) {
            const progressBar = document.getElementById('progressBar');
            const loadingText = document.getElementById('loadingText');
            const loadingHint = document.getElementById('loadingHint');
            
            if (currentStep < LOADING_STEPS.length) {
                const step = LOADING_STEPS[currentStep];
                loadingText.textContent = step.text;
                
                // Update progress bar
                const stepIncrement = (stepProgress * step.weight) / 100;
                totalProgress = Math.min(100, totalProgress + stepIncrement);
                progressBar.style.width = totalProgress + '%';
                
                // Update hints based on progress
                if (totalProgress > 50) {
                    loadingHint.textContent = "Almost there!";
                } else if (totalProgress > 30) {
                    loadingHint.textContent = "Loading AI models...";
                }
                
                // Move to next step if this one is complete
                if (stepProgress >= 100 && currentStep < LOADING_STEPS.length - 1) {
                    currentStep++;
                }
            }
        }
        
        // Initialize basic app
        function initBasicApp() {
            updateProgress(30);
            
            // Load Font Awesome (essential icons)
            const faLink = document.createElement('link');
            faLink.rel = 'stylesheet';
            faLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
            faLink.onload = () => updateProgress(50);
            document.head.appendChild(faLink);
            
            // Load main CSS
            const cssLink = document.createElement('link');
            cssLink.rel = 'stylesheet';
            cssLink.href = 'src/css/main.css?optimized';
            cssLink.onload = () => updateProgress(70);
            document.head.appendChild(cssLink);
            
            // Load main app logic
            const appScript = document.createElement('script');
            appScript.src = 'src/js/app-core.js?v=1'; // Optimized core file
            appScript.onload = () => {
                updateProgress(100);
                setTimeout(showApp, 500); // Brief delay for smooth transition
            };
            document.body.appendChild(appScript);
        }
        
        function showApp() {
            const splash = document.getElementById('splashScreen');
            const app = document.getElementById('app');
            
            splash.style.opacity = '0';
            splash.style.transition = 'opacity 0.5s ease';
            
            setTimeout(() => {
                splash.style.display = 'none';
                app.style.display = 'block';
                setTimeout(() => {
                    app.style.opacity = '1';
                }, 50);
            }, 500);
        }
        
        // Start loading process
        document.addEventListener('DOMContentLoaded', () => {
            updateProgress(10); // Initial progress
            setTimeout(() => initBasicApp(), 100);
        });
        
        // Service Worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js').catch(console.error);
        }
    </script>
</body>
</html>
